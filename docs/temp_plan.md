Ready to code?                                                                                                                                                                                                                                                                                                                                                                                                           │
│                                                                                                                                                                                                                                                                                                                                                                                                                          │
│ Here is Claude's plan:                                                                                                                                                                                                                                                                                                                                                                                                   │
│ ╭──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮ │
│ │ Meal Plan Generation Feature Implementation                                                                                                                                                                                                                                                                                                                                                                          │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ Service Architecture                                                                                                                                                                                                                                                                                                                                                                                                 │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ - New Service: MealPlanGenerator (following Sustainable Rails naming)                                                                                                                                                                                                                                                                                                                                                │ │
│ │   - Takes AR models as input (User, DailyMacroTarget, DailyMealStructure, name)                                                                                                                                                                                                                                                                                                                                      │ │
│ │   - Converts to POC format and calls FlexibleMealComposer                                                                                                                                                                                                                                                                                                                                                            │ │
│ │   - Converts POC results back to AR models                                                                                                                                                                                                                                                                                                                                                                           │ │
│ │   - Persists in transaction                                                                                                                                                                                                                                                                                                                                                                                          │ │
│ │   - Returns Result object with success/error                                                                                                                                                                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ Implementation Steps (15 small increments)                                                                                                                                                                                                                                                                                                                                                                           │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ Phase 1: Database Schema                                                                                                                                                                                                                                                                                                                                                                                             │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ 1. Create daily_meal_plans table migration (name, user_id, macro_target_id, meal_structure_id, target/actual macros, within_tolerance)                                                                                                                                                                                                                                                                               │ │
│ │ 2. Create meals table migration (daily_meal_plan_id, meal_type, actual macros)                                                                                                                                                                                                                                                                                                                                       │ │
│ │ 3. Create food_portions table migration (meal_id, food_id, grams)                                                                                                                                                                                                                                                                                                                                                    │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ Phase 2: Models                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ 4. Create DailyMealPlan model (validations, associations, helper methods)                                                                                                                                                                                                                                                                                                                                            │ │
│ │ 5. Create Meal model (validations, associations, helper methods)                                                                                                                                                                                                                                                                                                                                                     │ │
│ │ 6. Create FoodPortion model (validations, associations, calculated macros)                                                                                                                                                                                                                                                                                                                                           │ │
│ │ 7. Add model helper methods (within_tolerance?, total_grams, etc.)                                                                                                                                                                                                                                                                                                                                                   │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ Phase 3: Service Layer                                                                                                                                                                                                                                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ 8. Create MealPlanGenerator service                                                                                                                                                                                                                                                                                                                                                                                  │ │
│ │   - Convert DailyMealStructure → POC hash                                                                                                                                                                                                                                                                                                                                                                            │ │
│ │   - Convert DailyMacroTarget → MacroTargets PORO                                                                                                                                                                                                                                                                                                                                                                     │ │
│ │   - Call FlexibleMealComposer                                                                                                                                                                                                                                                                                                                                                                                        │ │
│ │   - Persist POC results as AR models in transaction                                                                                                                                                                                                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ Phase 4: Routes & Controller                                                                                                                                                                                                                                                                                                                                                                                         │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ 9. Add resources :meal_plans, except: [:edit, :update] route                                                                                                                                                                                                                                                                                                                                                         │ │
│ │ 10. Create MealPlansController (index, new, create, show, destroy)                                                                                                                                                                                                                                                                                                                                                   │ │
│ │ 11. Update _nav.html.erb to link to meal_plans_path                                                                                                                                                                                                                                                                                                                                                                  │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ Phase 5: Views                                                                                                                                                                                                                                                                                                                                                                                                       │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ 12. Create index.html.erb (table with empty state)                                                                                                                                                                                                                                                                                                                                                                   │ │
│ │ 13. Create new.html.erb (form with name + 2 dropdowns)                                                                                                                                                                                                                                                                                                                                                               │ │
│ │ 14. Create show.html.erb (detailed meal plan display with macro cards)                                                                                                                                                                                                                                                                                                                                               │ │
│ │ 15. Style consistently with existing Tailwind patterns                                                                                                                                                                                                                                                                                                                                                               │ │
│ │                                                                                                                                                                                                                                                                                                                                                                                                                      │ │
│ │ Ready to proceed step-by-step!
